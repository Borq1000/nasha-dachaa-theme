# Отчет о вирусном заражении сайта nasha-dachaa.ru

## Тип атаки
SEO-спам атака с целью манипуляции поисковой выдачей

## Источник заражения
Заражение произошло через уязвимости в следующих плагинах WordPress:
1. **Contact Form 7 - Маска телефонного номера** - плагин для маскирования телефонных номеров в формах
2. **Popup Builder** - плагин для создания всплывающих окон

Для обоих этих плагинов я использую бесплатную версию, функционала хватает. А для первого из неих вообще нет платной версии.


Устаревшие версии данных плагинов содержали уязвимости, которые позволили злоумышленникам внедрить вредоносный код на сайт.

## Принцип работы вируса
Вирус был направлен на манипуляцию SEO-параметрами сайта путем динамической подмены meta-заголовков страниц. Основная цель - перенаправление поискового трафика на нерелевантные запросы, что привело к потере позиций сайта по целевым строительным запросам.

### Механизм заражения
1. Первичное проникновение произошло через уязвимости в устаревших версиях плагинов WordPress
2. Вредоносный код был внедрен в следующие системные файлы:

```php
// Пример вредоносного кода (закомментирован в целях безопасности)
/*
// wp-includes/js/jquery/jquery.js
eval(base64_decode('ZnVuY3Rpb24gc2VvX2luamVjdCgkcGFnZV91cmwpIHsKICAgIC8vIENvZGUgdG8gaW5qZWN0IFNFT3NwYW0KfQ=='));
*/
```

### Обнаруженные вредоносные файлы
1. `/wp-includes/js/jquery/jquery.min.js.php`
   - Маскировался под легитимный jQuery файл
   - Содержал код для подмены заголовков

2. `/wp-content/themes/blago2/functions.php`
   - Внедренный код для перехвата запросов
   ```php
   /*
   add_filter('pre_get_document_title', function($title) {
       if(isset($_SERVER['HTTP_USER_AGENT']) && strpos($_SERVER['HTTP_USER_AGENT'], 'bot') !== false) {
           return get_spam_title();
       }
       return $title;
   });
   */
   ```

3. `/wp-content/uploads/cache/cache.php`
   - Скрытый файл для кэширования спам-контента
   ```php
   /*
   $spam_titles = array(
       '/drenazh-uchastka/' => '2 living room top chairs',
       '/glubinnyj-drenazh/' => '2 room tents for top sale',
       '/otmostka-cokolya-2/' => '2 rupees top chocolate',
       '/otsypka-zemelnogo-uchastka/' => '2015 dodge charger hellcat top price'
   );
   */
   ```

### Принцип нанесения урона
1. **SEO-манипуляции**:
   - Динамическая подмена title-тегов для поисковых ботов
   - Внедрение скрытых ссылок на спам-ресурсы
   - Создание невидимых для пользователей, но видимых для поисковых систем текстов

2. **Примеры подмены заголовков**:
   - Оригинал: "Дренаж участка, сделать дренаж вокруг дома | Цена"
   - Подмена: "2 living room top chairs"

   - Оригинал: "Глубинный дренаж участка под ключ в Москве и Подмосковье | Цена"
   - Подмена: "2 room tents for top sale"

3. **Механизм подмены**:
   - Вирус определял user-agent поисковых ботов
   - При обнаружении бота активировался механизм подмены контента
   - Для обычных посетителей сайт отображался нормально

